<!DOCTYPE html>
<html>
<head>
    <title></title>
     <style>

         #menuList{position: absolute;z-index:1000;display: none;}
         ul{list-style: none}
         #menuList li a{display: inline-block;width:100px;height:20px;}
         #menuList li a:hover{background: seagreen;cursor: pointer}
         .ondraw{cursor: pointer}
         .container{position: relative;}
     </style>
</head>
<body>
<div class="container">
<canvas width=500 height=500 style="margin:50px;border:1px solid blue" name="canvas" ></canvas>

<div id="menuList" data-close="true">
       <ul>
           <li>
              <a data-fc="wipe">换橡皮擦</a>
           </li>
           <li>
               <a data-fc="paint">换画笔</a>
           </li>
           <li>
               <a data-fc="drop">清空</a>
           </li>
       </ul>

</div>
</div>
<script src="/javascripts/jquery-1.11.0.min.js"></script>
<script src="/socket.io/socket.io.js" type="text/javascript"></script>
<script>
    var canvas=document.getElementsByName("canvas");
    for(var i=0;i<canvas.length;i++){
        var ctx=canvas[i].getContext("2d");
        ctx.strokeStyle="blue";
    }

    $(document).bind("contextmenu",function(){return false;});
    $("#menuList").delegate("a","click",function(e){
        var fc=$(this).data("fc");
            update(e,fc);//wipe paint drop
            if(fc=="wipe"){
                $(canvas).data("wipe",true);
            }else{
                $(canvas).data("wipe",false);
            }
        $("#menuList").hide()
    });

     $(canvas).bind("mousedown",function(e) {

          if(e.which==3){
              var top= e.pageY-20,left= e.pageX-20;
              $("#menuList").css({top:top,left:left}).show().data('open');

          }else if($("#menuList").data("close")){
              $("#menuList").hide();
              update(e,"record");
          }
     }) ;

     $(canvas).bind("mousemove",function(e){
         if($(canvas).data("wipe")){
             update(e,"wipe");
         }else{
             update(e,"paint");
         }

     }) ;

     $(canvas).bind("mouseup",function(e){
          update(e,"close");
     }) ;

     //var socket = io.connect('http://www.superchangme.com:3000/');
    var socket = io.connect('https://127.0.0.1');
     function update(e,act){
          socket.emit('paint msg', {
                            func : act,
                            offsetX :e.offsetX,
                            offsetY :e.offsetY,
                            which :e.which
          });
     }

</script>
</body>
</html>